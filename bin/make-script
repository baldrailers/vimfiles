#!/usr/bin/env node

var deps = JSON.parse(require('fs').readFileSync('.bowerlock')).dependencies;

var root = '$BUNDLE';

console.log('#!/usr/bin/env sh');
console.log('BUNDLE="bundle"');

Object.keys(deps).forEach(function (key) {
  var dep = deps[key];
  var m = dep.match(/^([^#]+)(?:#(.+))?$/);

  var source = m[1];
  var target = m[2] || 'master';
  var base = require('path').basename(source);
  var repo = 'git://github.com/' + source + '.git';
  var path = root + '/' + base;

  var cmd = "if [ ! -e "+path+" ]; then git clone "+repo+" "+path+" && (cd "+path+" && git checkout -q "+target+" 2>/dev/null || git checkout -q v"+target+" ); fi"
  console.log("echo \"\\n=> "+source+"\"");
  console.log(cmd);
});
